import pandas as pd
import os

# Load cleaned datasets
games_path = "data/cleaned_games.csv"
team_stats_path = "data/cleaned_team_statistics.csv"
players_path = "data/cleaned_players.csv"
player_stats_path = "data/cleaned_player_statistics.csv"
league_schedule_path = "data/cleaned_league_schedule.csv"
team_histories_path = "data/cleaned_team_histories.csv"

def load_csv(file_path):
    """Load a CSV file if it exists."""
    if not os.path.exists(file_path):
        print(f"‚ùå Error: {file_path} not found.")
        return None
    return pd.read_csv(file_path)

# Load all datasets
games_df = load_csv(games_path)
team_stats_df = load_csv(team_stats_path)
players_df = load_csv(players_path)
player_stats_df = load_csv(player_stats_path)
league_schedule_df = load_csv(league_schedule_path)
team_histories_df = load_csv(team_histories_path)

# Ensure datasets were loaded before proceeding
if games_df is not None and team_stats_df is not None:
    # Merge Games with Team Statistics on `team_id`
    merged_games_df = pd.merge(games_df, team_stats_df, on="team_id", how="left")
    merged_games_df.to_csv("data/merged_games_team_stats.csv", index=False)
    print("‚úÖ Merged Games with Team Statistics")

if players_df is not None and player_stats_df is not None:
    # Merge Players with Player Statistics on `person_id`
    merged_players_df = pd.merge(players_df, player_stats_df, on="person_id", how="left")
    merged_players_df.to_csv("data/merged_players_stats.csv", index=False)
    print("‚úÖ Merged Players with Player Statistics")

if league_schedule_df is not None and games_df is not None:
    # Merge League Schedule with Games on `game_id`
    merged_league_df = pd.merge(league_schedule_df, games_df, on="game_id", how="left")
    merged_league_df.to_csv("data/merged_league_games.csv", index=False)
    print("‚úÖ Merged League Schedule with Games")

if team_histories_df is not None and team_stats_df is not None:
    # Merge Team Histories with Team Statistics on `team_id`
    merged_teams_df = pd.merge(team_histories_df, team_stats_df, on="team_id", how="left")
    merged_teams_df.to_csv("data/merged_team_histories.csv", index=False)
    print("‚úÖ Merged Team Histories with Team Statistics")

print("üíæ All merged datasets saved in 'data/' directory.")
