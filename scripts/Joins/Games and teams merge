import pandas as pd

# Define file paths
games_path = "data/Games.csv"
players_path = "data/Players.csv"
team_stats_path = "data/TeamStatistics.csv"
player_stats_path = "data/PlayerStatistics (1).xlsx"
team_histories_path = "data/TeamHistories.csv"

# Load datasets
games_df = pd.read_csv(games_path)
players_df = pd.read_csv(players_path)
team_stats_df = pd.read_csv(team_stats_path)
player_stats_df = pd.read_excel(player_stats_path, engine="openpyxl")
team_histories_df = pd.read_csv(team_histories_path)

# Merge Player Stats with Players data
player_merged_df = pd.merge(player_stats_df, players_df, on="personId", how="left")

# Merge Game Data with Team Stats
team_merged_df = pd.merge(games_df, team_stats_df, on="gameId", how="left")

# Merge the above with Team Histories
final_team_df = pd.merge(team_merged_df, team_histories_df, on="teamId", how="left")

# Merge the team dataset with player dataset
final_df = pd.merge(final_team_df, player_merged_df, on="gameId", how="left")

# Save the final merged dataset
final_df.to_csv("data/final_merged_dataset.csv", index=False)

print("âœ… Successfully merged datasets and saved as final_merged_dataset.csv")
print(final_df.head())  # Preview first 5 rows
